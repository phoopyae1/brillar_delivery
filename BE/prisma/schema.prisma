// Prisma schema for office delivery tracking
// Datasource configured via DATABASE_URL env

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  SENDER
  DISPATCHER
  COURIER
  ADMIN
}

enum DeliveryStatus {
  DRAFT
  CREATED
  ASSIGNED
  PICKED_UP
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  CANCELLED
  FAILED_DELIVERY
  RETURNED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
}

model User {
  id         String           @id @default(uuid())
  name       String
  email      String           @unique
  password   String
  role       Role
  deliveries Delivery[]       @relation("SenderDeliveries")
  assignments Assignment[]    @relation("CourierAssignments")
  events     DeliveryEvent[]  @relation("UserEvents")
  createdAt  DateTime         @default(now())
}

model Delivery {
  id                 String            @id @default(uuid())
  trackingCode       String          @unique
  title              String
  description        String
  priority           Priority        @default(MEDIUM)
  status             DeliveryStatus  @default(CREATED)
  sender             User            @relation("SenderDeliveries", fields: [senderId], references: [id])
  senderId           String
  receiverName       String
  receiverPhone      String
  destinationAddress String
  pdfUrl             String?         // PDF file name for delivery label
  assignments        Assignment[]
  events             DeliveryEvent[]
  createdAt          DateTime        @default(now())
}

model Assignment {
  id         String    @id @default(uuid())
  delivery   Delivery @relation(fields: [deliveryId], references: [id])
  deliveryId String
  courier    User     @relation("CourierAssignments", fields: [courierId], references: [id])
  courierId  String
  assignedAt DateTime @default(now())
}

model DeliveryEvent {
  id           String            @id @default(uuid())
  delivery     Delivery        @relation(fields: [deliveryId], references: [id])
  deliveryId   String
  type         DeliveryStatus
  note         String?
  locationText String?
  proofImageUrl String?        // Base64 encoded image or URL for delivery proof
  createdBy    User            @relation("UserEvents", fields: [createdById], references: [id])
  createdById  String
  createdAt    DateTime        @default(now())
}
