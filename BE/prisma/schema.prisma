// Prisma schema for office delivery tracking
// Datasource configured via DATABASE_URL env

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  SENDER
  DISPATCHER
  COURIER
  ADMIN
}

enum DeliveryStatus {
  DRAFT
  CREATED
  ASSIGNED
  PICKED_UP
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  CANCELLED
  FAILED_DELIVERY
  RETURNED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
}

model User {
  id          String          @id @default(uuid())
  name        String
  email       String          @unique
  password    String
  phone       String?         // Phone number for sender registration
  role        Role
  createdAt   DateTime        @default(now())
  assignments Assignment[]    @relation("CourierAssignments")
  deliveries  Delivery[]      @relation("SenderDeliveries")
  events      DeliveryEvent[] @relation("UserEvents")
}

model Delivery {
  id                 String          @id @default(uuid())
  trackingCode       String          @unique
  title              String
  description        String
  priority           Priority        @default(MEDIUM)
  status             DeliveryStatus  @default(CREATED)
  senderId           String
  receiverName       String
  receiverPhone      String
  destinationAddress String
  createdAt          DateTime        @default(now())
  pdfUrl             String?         // PDF file name for delivery label
  assignments        Assignment[]
  sender             User            @relation("SenderDeliveries", fields: [senderId], references: [id])
  events             DeliveryEvent[]
}

model Assignment {
  id         String   @id @default(uuid())
  deliveryId String
  courierId  String
  assignedAt DateTime @default(now())
  courier    User     @relation("CourierAssignments", fields: [courierId], references: [id])
  delivery   Delivery @relation(fields: [deliveryId], references: [id])
}

model DeliveryEvent {
  id            String         @id @default(uuid())
  deliveryId    String
  type          DeliveryStatus
  note          String?
  locationText  String?
  createdById   String
  createdAt     DateTime       @default(now())
  proofImageUrl String?        // Base64 encoded image or URL for delivery proof
  createdBy     User           @relation("UserEvents", fields: [createdById], references: [id])
  delivery      Delivery       @relation(fields: [deliveryId], references: [id])
}
